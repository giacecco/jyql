/*! jyql - v0.0.1 - 2012-12-11
* https://github.com/giacecco/jyql
* Copyright (c) 2012 Gianfranco Cecconi
* Licensed MIT, Yahoo! terms of service, Yahoo! Query Language's terms of use */
(function(){var IS_NODE,browser_fetch,jyql,nodejs_fetch,request;IS_NODE=typeof module!="undefined"&&module.exports!=null,IS_NODE||(browser_fetch=function(query,callback){var addScript,callbackFunctionSource,randomName,_this=this;return addScript=function(e,t){var n,r,i=this;return n=document.getElementsByTagName("head")[0],r=document.createElement("script"),r.type="text/javascript",e.match(/^http[\s\S]*/)!=null?(r.src=e,r.onload=function(){return t(null)},n.appendChild(r)):(r.innerHTML=e,n.appendChild(r),t(null)),null},randomName="jyql_"+Math.random().toString(36).substr(2,7),callbackFunctionSource="var "+randomName+"_data = { };\nvar "+randomName+"_function = function (data) { "+randomName+"_data = data; };",addScript(callbackFunctionSource,function(){var protocol,_ref,_ref1,_ref2;return protocol="http",addScript(protocol+"://query.yahooapis.com/v1/public/yql?format=json&callback="+escape(randomName+"_function")+"&q="+escape(query),function(err){return callback(err,eval(randomName+"_data"))})})}),IS_NODE&&(request=require("request"),nodejs_fetch=function(e,t){var n,r=this;return n="http://query.yahooapis.com/v1/public/yql?format=json&q="+escape(e),request(n,function(e,n,r){var i;i=null;if(!e&&n.statusCode===200)try{i=JSON.parse(r)}catch(s){e=new Error("YQL returned data that is not valid JSON")}return t(e,i)})}),jyql=function(e,t){var n,r=this;return n=function(e,n){return!e&&(n!=null?n.error:void 0)&&(e=new Error(n.error.description)),t(e,n)},t==null||typeof t!="function"?null:e==null||e===""?t(new Error("No query was specified"),null):IS_NODE?nodejs_fetch(e,n):browser_fetch(e,n)};if(IS_NODE)return module.exports=jyql;this.jyql=jyql}).call(this);