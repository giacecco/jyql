// Generated by CoffeeScript 1.4.0
(function() {
  var addScript, jyql, root;

  addScript = function(script, callback) {
    var headID, newScript;
    headID = document.getElementsByTagName("head")[0];
    newScript = document.createElement('script');
    newScript.type = 'text/javascript';
    if ((script.match(/^http[\s\S]*/)) != null) {
      newScript.src = script;
      newScript.onload = function() {
        return callback(null);
      };
      headID.appendChild(newScript);
    } else {
      newScript.innerHTML = script;
      headID.appendChild(newScript);
      callback(null);
    }
    return null;
  };

  jyql = function(query, namespace, callback) {
    var callbackFunctionSource, randomCallbackName, randomDataName,
      _this = this;
    if (namespace == null) {
      namespace = 'jyql';
    }
    if (namespace !== '') {
      namespace += '_';
    }
    randomDataName = namespace + Math.random().toString(36).substr(2, 7);
    randomCallbackName = namespace + Math.random().toString(36).substr(2, 7);
    callbackFunctionSource = "var " + randomDataName + " = { };\nvar " + randomCallbackName + " = function (data) { " + randomDataName + " = data; };";
    addScript(callbackFunctionSource, function() {
      return addScript("http://query.yahooapis.com/v1/public/yql?format=json&callback=" + escape(randomCallbackName) + "&q=" + escape(query), function(err) {
        return callback(err, eval(randomDataName));
      });
    });
    return null;
  };

  root = typeof exports !== "undefined" && exports !== null ? exports : this;

  root.jyql = jyql;

}).call(this);
